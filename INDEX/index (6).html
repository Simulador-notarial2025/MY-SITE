<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Simulador de Documento - Notar√≠a Boliviana</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Lora:ital,wght@0,400;0,700;1,400&family=Montserrat:wght@400;600&family=Roboto+Slab:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --primary:#4f46e5;
      --accent:#06b6d4;
      --bg:#f8fafc;
      --card:#ffffff;
      --text:#0f172a;
      --radius:14px;
      font-family:'Inter',system-ui;
    }
    *{box-sizing:border-box}
    body{
      margin:0;min-height:100vh;background:linear-gradient(180deg,var(--bg),#eef2ff);color:var(--text);
      display:flex;align-items:flex-start;justify-content:center;padding:28px;
    }
    .app{width:1100px;max-width:100%;display:grid;grid-template-columns:420px 1fr;gap:20px;align-items:start;}
    .gear-btn{
      position:fixed;left:18px;top:18px;background:var(--card);border-radius:10px;padding:10px;box-shadow:0 6px 18px rgba(15,23,42,0.12);cursor:pointer;z-index:60;display:flex;align-items:center;justify-content:center
    }
    .panel{
      background:linear-gradient(180deg,var(--card),#fbfdff);padding:18px;border-radius:var(--radius);box-shadow:0 10px 30px rgba(2,6,23,0.08);
    }
    h1{font-size:20px;margin:0 0 12px 0}
    label{display:block;font-size:13px;margin-bottom:6px;color:#334155}
    select,input[type="color"],input[type="file"],.btn{width:100%}
    select,input[type="text"],textarea{width:100%;padding:10px;border-radius:10px;border:1px solid #e6eef8;background:transparent}
    textarea{min-height:220px;resize:vertical}
    .small{font-size:12px;color:#64748b}
    .left-col{display:flex;flex-direction:column;gap:12px}
    .row{display:flex;gap:10px}
    .row > *{flex:1}
    .btn{display:inline-block;padding:10px 12px;border-radius:10px;border:none;background:var(--primary);color:white;font-weight:600;cursor:pointer;transition:background 0.3s;}
    .btn.ghost{background:transparent;color:var(--primary);border:1px solid rgba(79,70,229,0.12);transition:color 0.3s,border 0.3s;}
    .preview-wrap{position:relative;border-radius:var(--radius);overflow:hidden;background:linear-gradient(180deg,#fff,#fbfdff);box-shadow:0 12px 30px rgba(2,6,23,0.06);min-height:520px;padding:22px}
    .preview-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
    .doc-type{font-weight:700;color:var(--primary)}
    .preview-body{background:var(--card);height:100%;padding:20px;border-radius:10px;border:1px dashed rgba(2,6,23,0.04);overflow:auto}
    .doc-title{font-size:18px;margin:0 0 8px}
    .doc-meta{font-size:13px;color:#64748b;margin-bottom:12px}
    .doc-image{max-width:160px;max-height:120px;border-radius:8px;display:block;margin-bottom:12px;object-fit:cover}
    .highlight-error{background-color:rgba(239,68,68,0.3);border-radius:3px;padding:0 2px;font-weight:600;color:#dc2626;}
    .highlight-warning{background-color:rgba(251,146,60,0.3);border-radius:3px;padding:0 2px;font-weight:600;color:#ea580c;}
    .ai-review-section {
      margin-top: 15px;
      padding: 12px;
      border-radius: 8px;
      background-color: #f1f5f9;
    }
    .ai-review-section h3 {
      margin-top: 0;
      color: var(--primary);
    }
    .ai-suggestion {
      margin: 8px 0;
      padding: 8px;
      border-left: 3px solid var(--accent);
      background-color: rgba(6, 182, 212, 0.05);
    }
    .ai-highlight {
      background-color: rgba(251, 146, 60, 0.2);
      padding: 2px 4px;
      border-radius: 3px;
    }
  </style>
</head>
<body>
  <button aria-label="Configuraci√≥n" class="gear-btn" id="toggleSettings" title="Configuraci√≥n">
    ‚öôÔ∏è
  </button>

  <div class="app">
    <div class="left-col">
      <div class="panel" id="settingsPanel" style="display:none">
        <h1>Configuraci√≥n</h1>
        <label>Colores principales</label>
        <div class="row">
          <input id="primaryColor" type="color" value="#4f46e5">
          <input id="accentColor" type="color" value="#06b6d4">
        </div>
        <label>Tipograf√≠a</label>
        <select id="fontSelect">
          <option value="Inter, system-ui">Inter</option>
          <option value="Montserrat, system-ui">Montserrat</option>
          <option value="Lora, serif">Lora</option>
          <option value="Roboto Slab, serif">Roboto Slab</option>
        </select>
      </div>

      <div class="panel">
        <h1>Simulador de Documento</h1>
        <label>Tipo de documento</label>
        <select id="docType">
          <option value="Contrato">Contrato</option>
          <option value="Testamento Hereditario">Testamento Hereditario</option>
          <option value="Sucesi√≥n">Sucesi√≥n</option>
          <option value="Carta Poder">Carta Poder</option>
        </select>
        <label>Introducir documento</label>
        <textarea id="docContent" placeholder="Escribe aqu√≠ el texto del documento...">Yo, [NOMBRE], declaro que...</textarea>
        <label>Subir documento</label>
        <input id="imageInput" type="file" accept=".pdf,.doc,.docx,image/*">
        <div style="margin-top:12px;display:flex;gap:8px">
          <button class="btn" id="revisarBtn">Revisar</button>
          <button class="btn ghost" id="previewBtn">Vista r√°pida</button>
        </div>
        <div style="margin-top:10px" class="small" id="statusBox">Listo ‚Äî ajusta opciones y presiona "Revisar" para validar.</div>
      </div>
    </div>

    <div class="preview-wrap">
      <div class="preview-header">
        <div>
          <div class="doc-type" id="previewType">Contrato</div>
          <div class="small">Previsualizaci√≥n</div>
        </div>
      </div>
      <div class="preview-body" id="previewBody">
        <h2 class="doc-title" id="previewTitle">[T√çTULO DEL DOCUMENTO]</h2>
        <div class="doc-meta" id="previewMeta">[Lugar y fecha]</div>
        <img id="previewImage" class="doc-image" src="" alt="" style="display:none">
        <div id="previewText" style="white-space:pre-wrap;line-height:1.6;color:var(--text);font-size:15px">Contenido del documento...</div>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.19/mammoth.browser.min.js"></script>

  <script>
    const toggleSettings=document.getElementById('toggleSettings');
    const settingsPanel=document.getElementById('settingsPanel');
    const docType=document.getElementById('docType');
    const docContent=document.getElementById('docContent');
    const imageInput=document.getElementById('imageInput');
    const primaryColor=document.getElementById('primaryColor');
    const accentColor=document.getElementById('accentColor');
    const fontSelect=document.getElementById('fontSelect');
    const previewType=document.getElementById('previewType');
    const previewText=document.getElementById('previewText');
    const previewTitle=document.getElementById('previewTitle');
    const previewMeta=document.getElementById('previewMeta');
    const previewImage=document.getElementById('previewImage');
    const revisarBtn=document.getElementById('revisarBtn');
    const previewBtn=document.getElementById('previewBtn');
    const statusBox=document.getElementById('statusBox');

    toggleSettings.addEventListener('click',()=>settingsPanel.style.display=settingsPanel.style.display==='none'?'block':'none');

    function applyPreview(){
      previewType.textContent=docType.value;
      previewTitle.textContent=docType.value;
      previewText.textContent=docContent.value||'[Documento vac√≠o]';
      const today=new Date();
      previewMeta.textContent=`Lugar: [_______] ‚Äî Fecha: ${today.toLocaleDateString()}`;
    }

    // ‚úÖ CAMBIO DE COLOR FUNCIONAL
    function applyColors(){
      document.documentElement.style.setProperty('--primary', primaryColor.value);
      document.documentElement.style.setProperty('--accent', accentColor.value);
    }

    primaryColor.addEventListener('input', applyColors);
    accentColor.addEventListener('input', applyColors);

    // ‚úÖ Cambio de tipograf√≠a
    fontSelect.addEventListener('change',()=>{
      document.documentElement.style.fontFamily=fontSelect.value;
    });

    // Resto del c√≥digo sin cambios
    imageInput.addEventListener('change',async e=>{
      const file=e.target.files[0];
      if(!file)return;
      const type=file.type;

      if(type.startsWith('image/')){
        const url=URL.createObjectURL(file);
        previewImage.src=url;
        previewImage.style.display='block';
        statusBox.textContent='Imagen cargada correctamente.';
      }else if(file.name.endsWith('.docx')){
        const reader=new FileReader();
        reader.onload=async function(event){
          const arrayBuffer=event.target.result;
          const result=await mammoth.convertToHtml({arrayBuffer:arrayBuffer});
          docContent.value=result.value.replace(/<[^>]+>/g,'');
          applyPreview();
          statusBox.textContent='Documento Word cargado y previsualizado.';
        };
        reader.readAsArrayBuffer(file);
      }else if(file.name.endsWith('.pdf')){
        const fileReader=new FileReader();
        fileReader.onload=function(){
          const typedarray=new Uint8Array(this.result);
          pdfjsLib.getDocument(typedarray).promise.then(async pdf=>{
            let text='';
            for(let i=1;i<=pdf.numPages;i++){
              const page=await pdf.getPage(i);
              const content=await page.getTextContent();
              text+=content.items.map(i=>i.str).join(' ')+'\n';
            }
            docContent.value=text.trim();
            applyPreview();
            statusBox.textContent='Documento PDF cargado y previsualizado.';
          });
        };
        fileReader.readAsArrayBuffer(file);
      }
    });

    // Funci√≥n de revisi√≥n legal especializada en derecho notarial boliviano
    function aiLegalReview(content) {
      const results = {
        errors: [],
        warnings: [],
        suggestions: []
      };

      // Verificar firma
      if (!content.toLowerCase().includes("firma") && 
          !content.toLowerCase().includes("firmado") && 
          !content.toLowerCase().includes("suscribo")) {
        results.errors.push({
          text: "Falta firma",
          reason: "No se encuentra ninguna menci√≥n a firma en el documento. En documentos notariales debe haber al menos una referencia a firma de las partes.",
          severity: "high"
        });
      }

      // Verificar edad (menor de edad)
      const agePatterns = [
        /menor\s+de\s+edad/i,
        /menor/i,
        /menores/i,
        /ni√±o/i,
        /ni√±a/i,
        /menores\s+de\s+edad/i
      ];
      
      let hasMinorReference = false;
      agePatterns.forEach(pattern => {
        if (pattern.test(content)) {
          hasMinorReference = true;
        }
      });
      
      if (hasMinorReference) {
        results.warnings.push({
          text: "Menor de edad",
          reason: "Se menciona a un menor de edad. En Bolivia, los menores de 18 a√±os requieren representaci√≥n legal para documentos notariales.",
          severity: "medium"
        });
      }

      // Verificar identificaci√≥n
      if (!content.toLowerCase().includes("cedula") && 
          !content.toLowerCase().includes("c√©dula") && 
          !content.toLowerCase().includes("dni")) {
        results.warnings.push({
          text: "Falta identificaci√≥n",
          reason: "No se menciona n√∫mero de c√©dula de identidad. En documentos notariales, es obligatorio incluir la identificaci√≥n de las partes.",
          severity: "medium"
        });
      }

      // Verificar requisitos notariales espec√≠ficos de Bolivia
      const boliviaRequirements = [
        { pattern: /testamento/i, requirement: "Deber√≠a incluir requisitos espec√≠ficos para testamentos seg√∫n la ley boliviana" },
        { pattern: /poder/i, requirement: "Deber√≠a incluir requisitos para carta de poder seg√∫n la ley boliviana" },
        { pattern: /contrato/i, requirement: "Deber√≠a incluir requisitos para contratos seg√∫n la ley boliviana" }
      ];

      boliviaRequirements.forEach(req => {
        if (req.pattern.test(content.toLowerCase())) {
          results.suggestions.push({
            text: req.requirement,
            reason: "Verifique que el documento cumpla con los requisitos legales bolivianos para este tipo de documento."
          });
        }
      });

      // Verificar formato de fechas
      const datePattern = /\d{1,2}\/\d{1,2}\/\d{4}/;
      if (!datePattern.test(content)) {
        results.warnings.push({
          text: "Formato de fecha",
          reason: "No se detecta formato de fecha est√°ndar. En documentos notariales, las fechas deben estar claramente definidas.",
          severity: "low"
        });
      }

      // Verificar uso de t√©rminos legales
      const legalTerms = [
        { term: "parte", count: 0 },
        { term: "contratante", count: 0 },
        { term: "notario", count: 0 },
        { term: "acta", count: 0 }
      ];

      legalTerms.forEach(term => {
        const regex = new RegExp(term.term, 'gi');
        const matches = content.match(regex);
        term.count = matches ? matches.length : 0;
      });

      const totalLegalTerms = legalTerms.reduce((sum, term) => sum + term.count, 0);
      if (totalLegalTerms < 3) {
        results.warnings.push({
          text: "Uso limitado de t√©rminos legales",
          reason: "El documento tiene pocos t√©rminos legales espec√≠ficos. Considere incluir m√°s terminolog√≠a jur√≠dica adecuada.",
          severity: "low"
        });
      }

      return results;
    }

    // Aplicar revisi√≥n legal
    revisarBtn.addEventListener('click', () => {
      const content = docContent.value;
      const review = aiLegalReview(content);
      
      // Actualizar estado
      let message = '';
      
      if (review.errors.length === 0 && review.warnings.length === 0 && review.suggestions.length === 0) {
        message = '<span style="color:green">‚úì Documento revisado. No se encontraron problemas graves seg√∫n normativa boliviana.</span>';
      } else {
        if (review.errors.length > 0) {
          message += `<span style="color:red">‚úó Problemas cr√≠ticos encontrados:</span><br>`;
          review.errors.forEach(error => {
            message += `<span class="highlight-error">${error.text}</span> ‚Üí ${error.reason}<br><br>`;
          });
        }
        
        if (review.warnings.length > 0) {
          message += `<span style="color:orange">‚ö† Advertencias:</span><br>`;
          review.warnings.forEach(warning => {
            message += `<span class="highlight-warning">${warning.text}</span> ‚Üí ${warning.reason}<br><br>`;
          });
        }
        
        if (review.suggestions.length > 0) {
          message += `<span style="color:#06b6d4">üí° Sugerencias:</span><br>`;
          review.suggestions.forEach(suggestion => {
            message += `<span class="ai-suggestion">${suggestion.text} - ${suggestion.reason}</span><br>`;
          });
        }
      }
      
      statusBox.innerHTML = message;
      
      // Aplicar resaltado al contenido
      applyPreview();
    });

    // Vista r√°pida
    previewBtn.addEventListener('click', () => {
      const content = docContent.value;
      const suggestions = [
        "Considera agregar cl√°usulas de confidencialidad",
        "Incluye una cl√°usula de rescisi√≥n",
        "A√±ade una cl√°usula de fuerza mayor",
        "Verifica que todas las firmas est√©n incluidas"
      ];
      
      let message = '<span style="color:#06b6d4">üí° Sugerencias para mejorar tu documento:</span><br>';
      suggestions.forEach(suggestion => {
        message += `<span style="font-size:13px">${suggestion}</span><br>`;
      });
      
      statusBox.innerHTML = message;
    });

    applyPreview();
  </script>
</body>
</html>
